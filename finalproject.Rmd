---
title: "Final Project"
author: "Group 4"
date: "5/27/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(readxl)
```

```{r}
schools <- read_xlsx("US_schools_data.xlsx")
```

```{r}
clean_schools <-schools %>%
  select(PRIMARY_KEY,
         TOTAL_EXPENDITURE, 
         INSTRUCTION_EXPENDITURE, 
         SUPPORT_SERVICES_EXPENDITURE, 
         OTHER_EXPENDITURE, 
         CAPITAL_OUTLAY_EXPENDITURE, 
         ends_with("READING"), 
         ends_with("MATHEMATICS"))
clean_schools
```

```{r}

clean_schools$PRIMARY_KEY <- str_replace(clean_schools$PRIMARY_KEY,"_", " ")

clean_schools <- clean_schools %>%
  separate(PRIMARY_KEY, 
           into = c("year", "state"), 
           sep = " ")
```

```{r}
clean_schools <- clean_schools %>%
  pivot_longer("G04_A_A_READING":"G08_TR_A_MATHEMATICS",
               names_to = c("grade","race", "sex", "test"),
               names_sep = "_",
               values_to = "count")
```


```{r}
clean_schools <- clean_schools %>%
  mutate(sex = as.factor(sex),
         race = fct_recode(as.factor(clean_schools$race), all = "A"),
         test = as.factor(test),
         grade =as.factor(grade)
         )
  
```


```{r}
MIDWEST <- c("INDIANA","ILLINOIS","MICHIGAN","OHIO","WISCONSIN",
             "IOWA","KANSAS","MINNESOTA","MISSOURI","NEBRASKA",
             "NORTH DAKOTA","SOUTH DAKOTA")

NORTHEAST <- c("CONNECTICUT","MAINE","MASSACHUSETTS","NEW HAMPSHIRE",
             "RHODE ISLAND","VERMONT","NEW JERSEY","NEW YORK",
             "PENNSYLVANIA")

SOUTH <- c("DELAWARE","DISTRICT","FLORIDA","GEORGIA",
            "MARYLAND","NORTH CAROLINA","SOUTH CAROLINA","VIRGINIA",
            "WEST VIRGINIA","ALABAMA","KENTUCKY","MISSISSIPPI",
            "TENNESSEE","ARKANSAS","LOUISIANA","OKLAHOMA","TEXAS")

WEST <- c("ARIZONA","COLORADO","IDAHO","NEW MEXICO","MONTANA",
            "UTAH","NEVADA","WYOMING","ALASKA","CALIFORNIA",
            "HAWAII","OREGON","WASHINGTON")

clean_schools %>%
  mutate(region = if_else(state %in% MIDWEST, "Midwest", 
                          if_else(state %in% NORTHEAST, "Northeast", 
                                  if_else(state %in% SOUTH, "South", 
                                          if_else(state %in% WEST, "West", "Other")))))
```


