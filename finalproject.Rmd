---
title: "Final Project"
author: "Group 4"
date: "5/27/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(readxl)
```

```{r}
schools <- read_xlsx("US_schools_data.xlsx")
```

```{r}
clean_schools <-schools %>%
  select(PRIMARY_KEY,
         TOTAL_EXPENDITURE, 
         INSTRUCTION_EXPENDITURE, 
         SUPPORT_SERVICES_EXPENDITURE, 
         OTHER_EXPENDITURE, 
         CAPITAL_OUTLAY_EXPENDITURE, 
         ends_with("READING"), 
         ends_with("MATHEMATICS"))
```

```{r}
clean_schools$PRIMARY_KEY <- str_replace(clean_schools$PRIMARY_KEY,"_", " ")

clean_schools <- clean_schools %>%
  separate(PRIMARY_KEY, 
           into = c("year", "state"), 
           sep = " ")
```

```{r}
clean_schools <- clean_schools %>%
  pivot_longer("G04_A_A_READING":"G08_TR_A_MATHEMATICS",
               names_to = c("grade","race", "sex", "test"),
               names_sep = "_",
               values_to = "score")
```


```{r}
clean_schools <- clean_schools %>%
  mutate(sex = as.factor(sex),
         race = fct_recode(as.factor(clean_schools$race), all = "A"),
         test = as.factor(test),
         grade =as.factor(grade),
         year = as.numeric(year)
         )
```


```{r}
MIDWEST <- c("INDIANA","ILLINOIS","MICHIGAN","OHIO","WISCONSIN",
             "IOWA","KANSAS","MINNESOTA","MISSOURI","NEBRASKA",
             "NORTH DAKOTA","SOUTH DAKOTA")

NORTHEAST <- c("CONNECTICUT","MAINE","MASSACHUSETTS","NEW HAMPSHIRE",
             "RHODE ISLAND","VERMONT","NEW JERSEY","NEW YORK",
             "PENNSYLVANIA")

SOUTH <- c("DELAWARE","DISTRICT","FLORIDA","GEORGIA",
            "MARYLAND","NORTH CAROLINA","SOUTH CAROLINA","VIRGINIA",
            "WEST VIRGINIA","ALABAMA","KENTUCKY","MISSISSIPPI",
            "TENNESSEE","ARKANSAS","LOUISIANA","OKLAHOMA","TEXAS")

WEST <- c("ARIZONA","COLORADO","IDAHO","NEW MEXICO","MONTANA",
            "UTAH","NEVADA","WYOMING","ALASKA","CALIFORNIA",
            "HAWAII","OREGON","WASHINGTON")

clean_schools <- clean_schools %>%
  mutate(region = if_else(state %in% MIDWEST, "Midwest", 
                          if_else(state %in% NORTHEAST, "Northeast", 
                                  if_else(state %in% SOUTH, "South", 
                                          if_else(state %in% WEST, "West", "Other")))))

```


```{r}
clean_schools %>%
  ggplot(aes(x = INSTRUCTION_EXPENDITURE, y = score, color = race)) +
  geom_point() +
  labs(x = "Instructional Expenditures ($)", 
       y = "Testing scores")  +
  facet_wrap(~race)

clean_schools %>%
  ggplot(aes(x = INSTRUCTION_EXPENDITURE, y = score, color = sex)) +
  geom_point() +
  labs(x = "Instructional Expenditures ($)", 
       y = "Testing scores")  +
  facet_wrap(~sex)
```

```{r visuals}
clean_schools %>%
  ggplot()+
  geom_density(mapping = aes(x = score, fill = test))+
  facet_wrap(~race) +
  labs(title = "Math and Test Scores Density", x = "Test Scores", fill = "Test")

clean_schools %>%
  ggplot()+
  geom_density(mapping = aes(x = score, fill = test))+
  facet_wrap(~sex) +
  labs(title = "Math and Test Scores Density", x = "Test Scores", fill = "Test")
```

```{r visuals}
clean_schools %>%
  group_by(year) %>%
  mutate(avg = mean(INSTRUCTION_EXPENDITURE, na.rm = TRUE)) %>%
  mutate(year = as.numeric(year)) %>%
  filter(!is.na(INSTRUCTION_EXPENDITURE)) %>%
  group_by(year) %>%
  ggplot()+
  geom_line(mapping = aes(x = year, y = avg, color = test)) +
  facet_wrap(~test)
```


```{r}
clean_schools %>%
  filter(test == "MATHEMATICS") %>%
  lm(score ~ INSTRUCTION_EXPENDITURE, data = .) ->
  math_model

clean_schools %>%
  filter(test == "READING") %>%
  lm(score ~ INSTRUCTION_EXPENDITURE, data = .) ->
  reading_model
  
```

```{r}
summary(math_model)
summary(reading_model)
```




